---
phase: 01-foundation-real-time-transcription
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - tsconfig.json
  - app/layout.tsx
  - app/globals.css
  - app/page.tsx
  - app/manifest.ts
  - app/(auth)/login/page.tsx
  - app/(auth)/signup/page.tsx
  - app/(app)/layout.tsx
  - app/(app)/record/page.tsx
  - app/(app)/transcripts/page.tsx
  - app/(app)/settings/page.tsx
  - app/components/navigation/fab-menu.tsx
  - app/components/ui/*
  - convex/schema.ts
  - convex/auth.config.ts
  - convex/auth.ts
  - convex/http.ts
  - convex/transcripts.ts
  - public/icons/*
  - .env.local
autonomous: true
user_setup:
  - service: convex
    why: "Real-time backend and auth"
    env_vars:
      - name: CONVEX_DEPLOYMENT
        source: "Auto-generated by npx convex dev"
      - name: NEXT_PUBLIC_CONVEX_URL
        source: "Auto-generated by npx convex dev"
  - service: deepgram
    why: "Speech-to-text transcription API"
    env_vars:
      - name: DEEPGRAM_API_KEY
        source: "Deepgram Console -> Settings -> API Keys -> Create Key"

must_haves:
  truths:
    - "User can create an account with email/password"
    - "User can log in and stays logged in across browser refresh"
    - "Authenticated user sees FAB navigation menu"
    - "FAB menu navigates to Transcripts, Record, and Settings pages"
    - "App is installable as PWA on mobile (manifest present)"
  artifacts:
    - path: "convex/schema.ts"
      provides: "Database schema for transcripts, words, recordings"
      contains: "defineSchema"
    - path: "convex/auth.config.ts"
      provides: "Convex Auth configuration"
      contains: "providers"
    - path: "app/manifest.ts"
      provides: "PWA manifest for installability"
      contains: "MetadataRoute.Manifest"
    - path: "app/(auth)/login/page.tsx"
      provides: "Login page"
      min_lines: 20
    - path: "app/components/navigation/fab-menu.tsx"
      provides: "FAB navigation menu component"
      min_lines: 30
    - path: "app/(app)/layout.tsx"
      provides: "Authenticated layout with auth guard"
      contains: "useConvexAuth"
  key_links:
    - from: "app/layout.tsx"
      to: "ConvexAuthProvider"
      via: "Provider wrapping"
      pattern: "ConvexAuthProvider"
    - from: "app/(app)/layout.tsx"
      to: "convex/auth"
      via: "Auth guard redirect"
      pattern: "isAuthenticated"
    - from: "app/components/navigation/fab-menu.tsx"
      to: "app/(app)/*"
      via: "Next.js router navigation"
      pattern: "useRouter|Link"
---

<objective>
Set up the Next.js project with Convex backend, authentication, PWA manifest, FAB navigation, and database schema. This creates the complete foundation that all subsequent plans build on.

Purpose: Establish the project scaffold, auth flow, navigation, and data model so recording and transcription features have a solid base to integrate into.
Output: Working Next.js app with Convex Auth (login/signup), protected routes, FAB navigation menu, PWA installability, and complete database schema.
</objective>

<execution_context>
@/Users/lucasalexander/.claude/get-shit-done/workflows/execute-plan.md
@/Users/lucasalexander/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-real-time-transcription/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Next.js project with Convex, Auth, and PWA manifest</name>
  <files>
    package.json
    tsconfig.json
    app/layout.tsx
    app/globals.css
    app/page.tsx
    app/manifest.ts
    app/(auth)/login/page.tsx
    app/(auth)/signup/page.tsx
    convex/schema.ts
    convex/auth.config.ts
    convex/auth.ts
    convex/http.ts
    convex/transcripts.ts
    .env.local
    public/icons/icon-192.png
    public/icons/icon-512.png
  </files>
  <action>
    1. Create Next.js 16 app: `npx create-next-app@latest . --typescript --tailwind --app --src-dir=false --import-alias="@/*" --turbopack`
       (Run in project root, overwrite existing files if prompted)

    2. Install dependencies:
       ```
       npm install convex @convex-dev/auth @auth/core
       npm install zustand
       npm install react-voice-visualizer
       npm install -D prettier prettier-plugin-tailwindcss
       ```
       Note: Do NOT install @deepgram/sdk yet — it will be used in Convex actions (server-side) and needs specific handling in Plan 02.

    3. Initialize Convex: `npx convex dev --once` (this creates convex/ directory and .env.local with CONVEX_DEPLOYMENT and NEXT_PUBLIC_CONVEX_URL).
       If user hasn't authenticated with Convex CLI, this will prompt — that's expected.

    4. Set up Convex Auth:
       - Create `convex/auth.config.ts` with password provider (email/password credentials)
       - Create `convex/auth.ts` with auth tables setup using `convexAuth()` from @convex-dev/auth/server
       - Create `convex/http.ts` with HTTP router for auth endpoints
       - Follow the Convex Auth docs pattern: the auth.ts file exports `{ auth, signIn, signOut, store }` and schema.ts must include auth tables

    5. Create `convex/schema.ts` with these tables:
       - Auth tables (from convex auth setup — use `authTables` from @convex-dev/auth/server)
       - `transcripts` table: userId (v.id("users")), title (v.string()), status (v.union("recording", "completed", "error")), duration (v.optional(v.number())), createdAt (v.number()), completedAt (v.optional(v.number()))
       - `words` table: transcriptId (v.id("transcripts")), text (v.string()), speaker (v.optional(v.number())), startTime (v.number()), endTime (v.number()), isFinal (v.boolean())
         Index: by_transcript on ["transcriptId"]
       - `speakerLabels` table: transcriptId (v.id("transcripts")), speakerNumber (v.number()), label (v.string())
         Index: by_transcript on ["transcriptId"]
       - `recordings` table: transcriptId (v.id("transcripts")), storageId (v.id("_storage")), format (v.string()), size (v.number())
         Index: by_transcript on ["transcriptId"]

    6. Create `convex/transcripts.ts` with basic queries/mutations:
       - `create` mutation: creates transcript with status "recording", sets createdAt to Date.now()
       - `get` query: returns transcript by ID (with auth check — user must own it)
       - `list` query: returns all transcripts for authenticated user, ordered by createdAt desc
       - `appendWords` mutation: inserts word records into words table (batch insert for efficiency)
       - `updateSpeakerLabel` mutation: upserts speaker label for a transcript
       - `complete` mutation: sets status to "completed", sets completedAt and duration
       - `getWords` query: returns all words for a transcript, ordered by startTime
       - `getSpeakerLabels` query: returns all speaker labels for a transcript
       All queries/mutations must authenticate user via `ctx.auth.getUserIdentity()` and return null/throw if not authenticated.

    7. Set up root layout (`app/layout.tsx`):
       - Import and wrap with ConvexAuthProvider (from @convex-dev/auth/react) and ConvexReactClient
       - Create ConvexReactClient with process.env.NEXT_PUBLIC_CONVEX_URL
       - Add PWA meta tags: theme-color (#D2691E), apple-web-app-capable, apple-web-app-status-bar-style
       - Import globals.css with Tailwind
       - Set viewport meta for mobile: width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no

    8. Create PWA manifest (`app/manifest.ts`):
       - name: "Transcripts - AI Audio Transcription"
       - short_name: "Transcripts"
       - start_url: "/"
       - display: "standalone"
       - orientation: "portrait-primary"
       - background_color: "#FFF9F0" (cream)
       - theme_color: "#D2691E" (burnt sienna)
       - Icons: 192x192 and 512x512 PNG icons
       Generate placeholder PWA icons using a simple canvas-based script or create minimal PNG files with correct dimensions.

    9. Create auth pages:
       - `app/(auth)/login/page.tsx`: Email + password form, calls signIn from @convex-dev/auth/react with "password" provider, redirects to /record on success. Mobile-first Tailwind styling with warm color palette (cream bg, burnt sienna accents). Include link to signup page.
       - `app/(auth)/signup/page.tsx`: Email + password + confirm password form, calls signIn with flow "signUp", redirects to /record on success. Same styling. Include link to login page.
       Both pages should redirect to /record if already authenticated (check with useConvexAuth).

    10. Create root page (`app/page.tsx`): Redirect to /record if authenticated, /login if not.

    11. Configure Tailwind globals.css with warm color palette CSS custom properties:
        --background: cream (#FFF9F0), --foreground: dark text, --primary: burnt sienna (#D2691E), --accent: warm orange
  </action>
  <verify>
    - `npx convex dev --once` succeeds (schema pushes to Convex)
    - `npm run build` completes without errors
    - `npm run dev` starts and shows login page at localhost:3000
    - visiting /manifest.webmanifest returns valid JSON manifest
  </verify>
  <done>
    - Next.js app runs with Convex connected
    - Login and signup pages render with mobile-first styling
    - Convex schema deployed with transcripts, words, speakerLabels, recordings tables
    - PWA manifest accessible at /manifest.webmanifest
    - Root page redirects based on auth state
  </done>
</task>

<task type="auto">
  <name>Task 2: Create authenticated layout, FAB navigation, and stub pages</name>
  <files>
    app/(app)/layout.tsx
    app/(app)/record/page.tsx
    app/(app)/transcripts/page.tsx
    app/(app)/settings/page.tsx
    app/components/navigation/fab-menu.tsx
  </files>
  <action>
    1. Create authenticated layout (`app/(app)/layout.tsx`):
       - Use useConvexAuth() to check authentication state
       - If loading: show a minimal loading spinner (centered, mobile-friendly)
       - If not authenticated: redirect to /login using Next.js router
       - If authenticated: render children + FAB menu component
       - This layout wraps all (app) routes, enforcing auth

    2. Create FAB navigation menu (`app/components/navigation/fab-menu.tsx`):
       - Floating action button fixed at bottom-right of screen (bottom: 24px, right: 24px)
       - Default state: collapsed, shows a single circular button with menu icon (hamburger or plus)
       - Expanded state: shows 3 options stacked vertically above the FAB:
         - "Record" (microphone icon) -> /record
         - "Transcripts" (list icon) -> /transcripts
         - "Settings" (gear icon) -> /settings
       - Clicking FAB toggles expanded/collapsed
       - Clicking outside closes menu
       - Each option is a circular button with icon + small label
       - Animate expansion with CSS transitions (scale + opacity)
       - Use Tailwind for all styling: bg-primary (burnt sienna), text-white, shadow-lg, rounded-full
       - Highlight active route
       - Icons: use inline SVGs (not an icon library) to avoid extra dependency — simple microphone, list, and gear shapes

    3. Create stub pages with minimal content:
       - `app/(app)/record/page.tsx`: "Record" heading, placeholder text "Recording interface coming in Plan 02". Mobile-first padding.
       - `app/(app)/transcripts/page.tsx`: "Transcripts" heading, placeholder text "Transcript library coming in Phase 3". List transcripts from Convex using useQuery(api.transcripts.list). Show empty state if none.
       - `app/(app)/settings/page.tsx`: "Settings" heading, placeholder text "Settings coming in Phase 4". Include a sign-out button that calls signOut() from @convex-dev/auth/react.

    4. Ensure navigation works end-to-end:
       - FAB menu appears on all (app) routes
       - Clicking each FAB option navigates to correct page
       - Active route is visually indicated in FAB menu
       - Sign out from settings redirects to login page
  </action>
  <verify>
    - `npm run dev` and navigate through all routes via FAB menu
    - Unauthenticated access to /record redirects to /login
    - Sign out from settings page returns to login
    - FAB menu expands/collapses with animation
    - `npm run build` succeeds
  </verify>
  <done>
    - Authenticated layout guards all (app) routes
    - FAB navigation menu works with expand/collapse animation
    - All three stub pages (Record, Transcripts, Settings) accessible via FAB
    - Sign out works from Settings page
    - Active route highlighted in FAB menu
  </done>
</task>

</tasks>

<verification>
1. Full auth flow works: signup -> auto-login -> navigate app -> sign out -> login again
2. Session persists across browser refresh (close and reopen tab while logged in)
3. PWA manifest is valid (check with Chrome DevTools -> Application -> Manifest)
4. FAB menu navigates between all three pages
5. Convex schema deployed with all required tables
6. `npm run build` succeeds without errors
</verification>

<success_criteria>
- AUTH-01: User can create account and log in via Convex Auth
- AUTH-02: Session persists across browser refresh
- NAV-01: FAB navigation with Transcripts, Record, and Settings options
- NAV-02: App is installable as PWA (manifest present with correct metadata)
- Database schema ready for recording and transcription data
- All (app) routes protected behind authentication
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-real-time-transcription/01-01-SUMMARY.md`
</output>
