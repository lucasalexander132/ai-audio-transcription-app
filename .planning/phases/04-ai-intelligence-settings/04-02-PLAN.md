---
phase: 04-ai-intelligence-settings
plan: 02
type: execute
wave: 2
depends_on: ["04-01"]
files_modified:
  - app/components/audio/ai-summary.tsx
autonomous: true

must_haves:
  truths:
    - "User sees 'Generate Summary' button when no summary exists for a transcript"
    - "Tapping 'Generate Summary' shows animated skeleton placeholders while AI processes"
    - "After generation completes, overview paragraph, key points, and action items display"
    - "Button is disabled during generation to prevent double-tap"
    - "If summary already exists, it loads and displays immediately without Generate button"
    - "Action items show speaker assignment (bold inline name or 'Unassigned')"
    - "'No action items found' message displays when AI returns empty action items"
  artifacts:
    - path: "app/components/audio/ai-summary.tsx"
      provides: "Wired AI summary component with generate, loading, and display states"
      min_lines: 100
  key_links:
    - from: "app/components/audio/ai-summary.tsx"
      to: "convex/ai.ts getSummary"
      via: "useQuery(api.ai.getSummary)"
      pattern: "useQuery.*api\\.ai\\.getSummary"
    - from: "app/components/audio/ai-summary.tsx"
      to: "convex/ai.ts generateSummary"
      via: "useAction(api.ai.generateSummary)"
      pattern: "useAction.*api\\.ai\\.generateSummary"
---

<objective>
Wire the existing AI Summary component to real backend data, adding loading skeleton and generate flow.

Purpose: This connects the already-built AiSummary UI component to the generateSummary action and getSummary query from Plan 01. Users will be able to generate and view AI summaries for completed transcripts.

Output: Fully functional AI Summary tab on transcript detail page with generate, loading, and display states.
</objective>

<execution_context>
@/Users/lucasalexander/.claude/get-shit-done/workflows/execute-plan.md
@/Users/lucasalexander/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/04-ai-intelligence-settings/04-CONTEXT.md
@.planning/phases/04-ai-intelligence-settings/04-01-SUMMARY.md
@app/components/audio/ai-summary.tsx
@app/(app)/transcripts/[id]/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Wire AiSummary component to backend</name>
  <files>app/components/audio/ai-summary.tsx</files>
  <action>
    Rewrite the AiSummary component to connect to real backend data. Keep ALL existing sub-components (SectionHeader, SummaryCard, BulletPoint, ActionItem, TopicChip, icons, AiSummaryContent) exactly as they are. Only modify the main AiSummary export function.

    Update the AiSummary function:

    1. Add imports: useQuery, useAction from "convex/react", api from "@/convex/_generated/api", useState
    2. Query existing summary: `const summary = useQuery(api.ai.getSummary, { transcriptId })`
    3. Get the action: `const generateSummary = useAction(api.ai.generateSummary)`
    4. Track loading state: `const [isGenerating, setIsGenerating] = useState(false)`
    5. Track error state: `const [error, setError] = useState<string | null>(null)`

    Handle three states:

    **State A: Summary exists (summary is not null)**
    - Render AiSummaryContent with summary.overview, summary.keyPoints, summary.actionItems
    - For actionItems, map each item: { text: item.text, assignee: item.assignee === "Unassigned" ? undefined : item.assignee }
    - Pass topics as empty array (topics section omitted per CONTEXT.md decisions)
    - If summary.actionItems is empty, show a section card below AiSummaryContent with the CheckSquareIcon, "ACTION ITEMS" header, and text "No action items were identified in this transcript." styled in fontSize: 14, color: "#8B7E74"

    **State B: Loading/generating (isGenerating is true)**
    - Show skeleton placeholders inside the same card layout:
    - Overview skeleton: SummaryCard with SectionHeader "OVERVIEW" + 4 animated bars (heights: w-full h-4, w-5/6 h-4, w-4/5 h-4, w-3/4 h-4) using className="animate-pulse rounded" and backgroundColor="#EDE6DD"
    - Key Points skeleton: SummaryCard with SectionHeader "KEY POINTS" + 3 rows each with a small circle (w-2 h-2 rounded-full) + bar (flex-1 h-4)
    - Action Items skeleton: SummaryCard with SectionHeader "ACTION ITEMS" + 2 rows each with a square (w-5 h-5 rounded) + bar (flex-1 h-4)

    **State C: No summary yet (summary is null, not loading)**
    - Keep the existing empty state UI (sparkles icon, title, description, Generate Summary button)
    - Wire the button's onClick to call generateSummary:
      ```
      onClick={async () => {
        setIsGenerating(true);
        setError(null);
        try {
          await generateSummary({ transcriptId });
        } catch (e: any) {
          setError(e.message || "Failed to generate summary");
        } finally {
          setIsGenerating(false);
        }
      }}
      ```
    - Disable the button when isGenerating is true (opacity: 0.5, cursor: "not-allowed", pointerEvents: "none")
    - Show error message below button if error is not null: red text (color: "#E53E3E", fontSize: 13, marginTop: 8)

    Note: When summary query returns undefined (still loading from Convex), show a minimal loading state (single spinner or the skeleton). When it returns null, show the empty state. When it returns data, show the content.
  </action>
  <verify>Run `npm run build` or `npx next build` to verify the component compiles without TypeScript errors. Visually verify in browser: navigate to a completed transcript, click "AI Summary" tab, see the empty state with Generate button.</verify>
  <done>AiSummary component queries for existing summary, shows Generate button when none exists, shows skeleton during generation, displays results via AiSummaryContent when complete. Double-tap prevented by disabled state. Error state shown on failure. Empty action items show "No action items" message.</done>
</task>

</tasks>

<verification>
- `npm run build` completes without errors
- AiSummary component imports and uses useQuery(api.ai.getSummary) and useAction(api.ai.generateSummary)
- Three states handled: existing summary, generating, empty
- Skeleton loading animation visible during generation
- Generate button disabled during processing
- Error message shown on failure
</verification>

<success_criteria>
- User sees Generate Summary button on AI Summary tab for transcripts without summaries
- Tapping button shows animated skeleton, then results appear (overview, key points, action items)
- Existing summaries load immediately without Generate button
- Button disabled during generation prevents double-tap
- Action items with no assignee show "Unassigned" or are handled gracefully
</success_criteria>

<output>
After completion, create `.planning/phases/04-ai-intelligence-settings/04-02-SUMMARY.md`
</output>
