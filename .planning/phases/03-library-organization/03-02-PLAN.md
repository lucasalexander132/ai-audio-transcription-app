---
phase: 03-library-organization
plan: 02
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - app/(app)/transcripts/page.tsx
  - app/components/library/search-bar.tsx
  - app/components/library/filter-tabs.tsx
  - app/components/library/transcript-card.tsx
  - app/lib/hooks/use-debounce.ts
autonomous: true

must_haves:
  truths:
    - "User can type in search bar and see transcripts matching by title or content after 300ms debounce"
    - "User can switch between All, Recent, Starred, Meetings tabs with correct filtering"
    - "User can tap star icon on transcript card to toggle starred status"
    - "Each transcript card shows title, date, duration, source icon, text preview, star toggle, and tag chips"
    - "Each tab shows appropriate empty state when no transcripts match"
    - "Search is independent of tabs — always searches all transcripts"
  artifacts:
    - path: "app/(app)/transcripts/page.tsx"
      provides: "Enhanced library page with search, tabs, filtered list"
      min_lines: 80
    - path: "app/components/library/search-bar.tsx"
      provides: "Search input with debounce"
      exports: ["SearchBar"]
    - path: "app/components/library/filter-tabs.tsx"
      provides: "Tab buttons with active state"
      exports: ["FilterTabs"]
    - path: "app/components/library/transcript-card.tsx"
      provides: "Transcript card with star toggle, preview, tag chips"
      exports: ["TranscriptCard"]
    - path: "app/lib/hooks/use-debounce.ts"
      provides: "useDebounce hook"
      exports: ["useDebounce"]
  key_links:
    - from: "app/(app)/transcripts/page.tsx"
      to: "convex/transcripts.ts (search)"
      via: "useQuery with debounced search term"
      pattern: "api\\.transcripts\\.search"
    - from: "app/(app)/transcripts/page.tsx"
      to: "convex/tags.ts (getAllTranscriptTags)"
      via: "useQuery for Meetings tab filtering"
      pattern: "api\\.tags\\.getAllTranscriptTags"
    - from: "app/components/library/transcript-card.tsx"
      to: "convex/transcripts.ts (toggleStar)"
      via: "useMutation on star icon click"
      pattern: "api\\.transcripts\\.toggleStar"
---

<objective>
Rebuild the transcript library page with working search, filter tabs, star toggle, and enhanced transcript cards. This transforms the static list into a fully interactive, searchable library.

Purpose: Users need to find, filter, and organize their transcripts efficiently.
Output: Working library page with search, tabs (All/Recent/Starred/Meetings), star toggle, enhanced cards.
</objective>

<execution_context>
@/Users/lucasalexander/.claude/get-shit-done/workflows/execute-plan.md
@/Users/lucasalexander/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-library-organization/03-CONTEXT.md
@.planning/phases/03-library-organization/03-RESEARCH.md
@.planning/phases/03-library-organization/03-01-SUMMARY.md
@app/(app)/transcripts/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create search bar, filter tabs, and debounce hook components</name>
  <files>app/components/library/search-bar.tsx, app/components/library/filter-tabs.tsx, app/lib/hooks/use-debounce.ts</files>
  <action>
**Create `app/lib/hooks/use-debounce.ts`:**
- Generic `useDebounce<T>(value: T, delay: number): T` hook
- Uses useState + useEffect with setTimeout/clearTimeout pattern
- Default delay will be 300ms when used

**Create `app/components/library/search-bar.tsx`:**
- "use client" component
- Props: `{ value: string; onChange: (value: string) => void; onClear: () => void }`
- Full-width search input with search icon on left, clear (X) button on right when text present
- Style: white background, `#EDE6DD` border, rounded-full (pill shape), 44px height
- Placeholder: "Search transcripts..."
- Search icon: magnifying glass SVG in `#B5A99A`
- Clear button: X circle SVG in `#B5A99A`, only visible when value is non-empty
- Focus state: border changes to `#D4622B`
- Uses the warm color palette consistently

**Create `app/components/library/filter-tabs.tsx`:**
- "use client" component
- Props: `{ activeTab: string; onTabChange: (tab: string) => void; tabs: string[] }`
- Horizontal scrollable row of pill buttons
- Active tab: `backgroundColor: "#D4622B"`, `color: "#FFFFFF"`, `fontWeight: 600`
- Inactive tab: `backgroundColor: "#FFFFFF"`, `color: "#8B7E74"`, `border: "1px solid #EDE6DD"`
- Style matching the existing filter buttons in transcripts/page.tsx
- `overflow-x-auto no-scrollbar` for horizontal scroll
  </action>
  <verify>Files exist and export their components. No TypeScript errors: `npx tsc --noEmit` on the files.</verify>
  <done>SearchBar, FilterTabs, and useDebounce hook are created with correct props, styling, and behavior.</done>
</task>

<task type="auto">
  <name>Task 2: Create transcript card component with star toggle and preview</name>
  <files>app/components/library/transcript-card.tsx</files>
  <action>
**Create `app/components/library/transcript-card.tsx`:**
- "use client" component
- Props: `{ transcript: { _id, title, createdAt, duration?, status, source?, isStarred? }; tags: string[]; onClick: () => void }`
- Layout (vertical card, same structure as existing but enhanced):
  - Top row: source icon (mic for recording, upload for upload, document for completed) + title (truncate) + star icon button
  - Star icon: filled star SVG in `#D4622B` if starred, outline star SVG in `#B5A99A` if not
  - Star click: call `useMutation(api.transcripts.toggleStar)` with `e.stopPropagation()` to prevent card navigation
  - Info row: date (formatDate helper) + duration (formatDuration helper) + status badge
  - Tag chips row: show first 5 tags as plain text chips (if any), "+N more" if truncated
  - Tag chip style: `backgroundColor: "#F5EDE4"`, `color: "#8B7E74"`, rounded-full, padding `4px 10px`, fontSize 11
- Card style: white background, `#EDE6DD` border, 16px border-radius, 16px padding
- Keep the existing `formatDate` and `formatDuration` helpers (move them into this component or a shared utils file)
- The whole card is clickable (onClick), but star button stops propagation
  </action>
  <verify>File exists and exports TranscriptCard. Component accepts the defined props.</verify>
  <done>TranscriptCard renders title, date, duration, source icon, star toggle, and tag chips with correct styling and star mutation wiring.</done>
</task>

<task type="auto">
  <name>Task 3: Rewrite transcripts page with search, tabs, filtered list, and empty states</name>
  <files>app/(app)/transcripts/page.tsx</files>
  <action>
**Rewrite `app/(app)/transcripts/page.tsx` to compose the new components:**

1. **State management:**
   - `const [searchInput, setSearchInput] = useState("")` — raw search input
   - `const debouncedSearch = useDebounce(searchInput, 300)` — debounced for query
   - `const [activeTab, setActiveTab] = useState("All")` — current filter tab
   - `const [showSearch, setShowSearch] = useState(false)` — toggle search bar visibility

2. **Data fetching:**
   - `useQuery(api.transcripts.list)` — all transcripts (for tab filtering)
   - `useQuery(api.transcripts.search, debouncedSearch.length >= 2 ? { searchTerm: debouncedSearch } : "skip")` — search results
   - `useQuery(api.tags.getAllTranscriptTags)` — all transcript-tag mappings for Meetings filter + card display

3. **Display logic:**
   - If `debouncedSearch.length >= 2` and searchResults exist: show search results (with "Search results" header showing count)
   - Otherwise: apply tab filter on `allTranscripts`:
     - "All": show all completed/processing/error transcripts (exclude "recording")
     - "Recent": created within last 7 days (`Date.now() - 7 * 24 * 60 * 60 * 1000`)
     - "Starred": `isStarred === true`
     - "Meetings": has a tag named "Meetings" (case-insensitive match using transcriptTags data)
   - Sort by createdAt descending (newest first)

4. **Layout:**
   - Header row: "Transcripts" h1 + search button (toggles search bar) + profile button
   - When showSearch is true: SearchBar appears below header with slide-in animation
   - FilterTabs row (hidden when search is active with results)
   - Transcript list using TranscriptCard components
   - Pass tag names array to each TranscriptCard from the transcriptTags lookup

5. **Empty states per tab** (shown when filtered list is empty):
   - "All": microphone icon circle (`#FFF0E6` bg), "No transcripts yet", "Start a new recording to create your first transcript"
   - "Recent": clock icon circle, "No recent transcripts", "Transcripts from the last 7 days appear here"
   - "Starred": star icon circle, "No starred transcripts", "Star transcripts to find them quickly"
   - "Meetings": tag icon circle, "No meetings", "Tag transcripts as 'Meetings' to see them here"
   - Search empty: search icon circle, "No results", "Try a different search term"
   - All use same pattern: 64px icon circle in `#FFF0E6`, title in font-serif, description in `#8B7E74`

6. **Loading state:** Keep existing shimmer/pulse loading skeleton
  </action>
  <verify>Run `npm run build` or check the page loads at `/transcripts`. Search input appears when tapping search icon, tabs filter correctly, star toggle works, empty states show for each tab.</verify>
  <done>
Library page shows search bar (toggle), working filter tabs (All/Recent/Starred/Meetings), transcript cards with star toggle and tag chips, appropriate empty states per tab, and search results with debounced Convex query.
  </done>
</task>

</tasks>

<verification>
1. Search bar appears when tapping search icon, debounces input, shows results from Convex search
2. All/Recent/Starred/Meetings tabs filter transcripts correctly
3. Star icon toggles on tap (fills/unfills), persists across page reload
4. Empty states display correctly for each tab with appropriate icon and message
5. Tag chips appear on cards that have tags
6. No regressions: existing transcript list still loads, cards are clickable and navigate to detail
</verification>

<success_criteria>
- User can search transcripts by title/content with real-time debounced results
- User can switch tabs and see correct filtered subsets
- User can star/unstar transcripts from the library list
- Each tab has an appropriate empty state
- Transcript cards show title, date, duration, star status, and tags
</success_criteria>

<output>
After completion, create `.planning/phases/03-library-organization/03-02-SUMMARY.md`
</output>
